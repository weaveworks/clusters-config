provider "kubectl" {
  host                   = "https://66AEA5A038F7AFB34662B2C7CFF3010D.gr7.eu-north-1.eks.amazonaws.com"
  cluster_ca_certificate = "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1ERXhNVEUzTWpReE5sb1hEVE16TURFd09ERTNNalF4Tmxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTksyCndMMENqRTNwbjl4b3luWmR4UlpVc1h4bEpDN3pIeTc1SmgyN2xVQ1dDOFoxTTRkaWJTT3RtcXFheXBPTzkyU0QKTWlic0JCSUhmenhHMFcraDFPSEZ6dm0yeGVGV0N3em1tWTNIdmU4dGp2dlVMdU5pT0VMWE9SQXZud2d4V2d0TAphTWFIYmk1K0hBdUcxdWZtK2tTNlVISmxoeUtJSmlENDFQZDlSd29XNXExa2NoWEFzelJHT2lXdVpraC9kRE9TCjlXdWE5NjdjdlF6eWtQMzVDeU1XaCtNVTlobFMxelVYaktoRHBvT1NlcS9Zb0ltYVpMUXpDL09CSHV5NHhlN3IKMzBtSEFHMXowYUdzRnlsa0dLR0tmVjE3dlhCSStIc1F5clh5ZDJhUlM3TnFsVElvNEM5bmZLVnlVZ05FdERJKwpnS245UnJmb21RSXR1WEt0WXhFQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZMYk5mMkNENGpyYkxEVGhURFNOSUVXOU5EUGpNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRHNzd0RNSk1rdTc5cnNwRll0awp1MlpHcGx4a1NnVUN3VnoxSkdZYlhTV21KUDNHRTJSMGFtSmNxclBDMU5jRUE1NXVLVk1JNm12d3JUTFdyMVI5CjBsd2NsL254NmpERFFxOThRcGY3SE1TUjVHS2JSS3IzNmxpSi9HaVlRYk9VZnN1SGFySlZFOUN5YjhCZmdORW0KMFNmSnhHT3lZUGplWldBVUhUZHg5a1kzVVNlT1ZZblRHR05hRWFQcFlEYXhXazdhTW9Ga2IrdkNnRVJwekU5VQpGRDE5WjJmOFgrZ3FqNmhxZkFYTWZiMm44bjVJa3prYXNmb3lSRWoraDVLYnpnVmk3R1gvZWxlQmV1eVVxV0dNClh0TVpKRHB4SngvWVhMd0tqWEcvcU1RTG4xb2U5NjBwN0hqaVJzMUFqRTFmR0FENUczQlFXZXVoUFhmT2lQR2UKeWZBPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="
}

provider "kubernetes" {
  host                   = "https://66AEA5A038F7AFB34662B2C7CFF3010D.gr7.eu-north-1.eks.amazonaws.com"
  cluster_ca_certificate = "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1ERXhNVEUzTWpReE5sb1hEVE16TURFd09ERTNNalF4Tmxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTksyCndMMENqRTNwbjl4b3luWmR4UlpVc1h4bEpDN3pIeTc1SmgyN2xVQ1dDOFoxTTRkaWJTT3RtcXFheXBPTzkyU0QKTWlic0JCSUhmenhHMFcraDFPSEZ6dm0yeGVGV0N3em1tWTNIdmU4dGp2dlVMdU5pT0VMWE9SQXZud2d4V2d0TAphTWFIYmk1K0hBdUcxdWZtK2tTNlVISmxoeUtJSmlENDFQZDlSd29XNXExa2NoWEFzelJHT2lXdVpraC9kRE9TCjlXdWE5NjdjdlF6eWtQMzVDeU1XaCtNVTlobFMxelVYaktoRHBvT1NlcS9Zb0ltYVpMUXpDL09CSHV5NHhlN3IKMzBtSEFHMXowYUdzRnlsa0dLR0tmVjE3dlhCSStIc1F5clh5ZDJhUlM3TnFsVElvNEM5bmZLVnlVZ05FdERJKwpnS245UnJmb21RSXR1WEt0WXhFQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZMYk5mMkNENGpyYkxEVGhURFNOSUVXOU5EUGpNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRHNzd0RNSk1rdTc5cnNwRll0awp1MlpHcGx4a1NnVUN3VnoxSkdZYlhTV21KUDNHRTJSMGFtSmNxclBDMU5jRUE1NXVLVk1JNm12d3JUTFdyMVI5CjBsd2NsL254NmpERFFxOThRcGY3SE1TUjVHS2JSS3IzNmxpSi9HaVlRYk9VZnN1SGFySlZFOUN5YjhCZmdORW0KMFNmSnhHT3lZUGplWldBVUhUZHg5a1kzVVNlT1ZZblRHR05hRWFQcFlEYXhXazdhTW9Ga2IrdkNnRVJwekU5VQpGRDE5WjJmOFgrZ3FqNmhxZkFYTWZiMm44bjVJa3prYXNmb3lSRWoraDVLYnpnVmk3R1gvZWxlQmV1eVVxV0dNClh0TVpKRHB4SngvWVhMd0tqWEcvcU1RTG4xb2U5NjBwN0hqaVJzMUFqRTFmR0FENUczQlFXZXVoUFhmT2lQR2UKeWZBPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="
}


resource "kubectl_manifest" "external_secrets_repo" {
  yaml_body = <<-YAML
    apiVersion: source.toolkit.fluxcd.io/v1beta1
    kind: HelmRepository
    metadata:
      name: external-secrets
      namespace: flux-system
    spec:
      interval: 10m
      url: https://charts.external-secrets.io
  YAML
}

resource "kubectl_manifest" "external_secrets_release" {
  yaml_body = <<-YAML
    apiVersion: helm.toolkit.fluxcd.io/v2beta1
    kind: HelmRelease
    metadata:
      name: external-secrets
      namespace: flux-system
    spec:
      releaseName: external-secrets
      targetNamespace: external-secrets
      interval: 10m
      chart:
        spec:
          chart: external-secrets
          sourceRef:
            kind: HelmRepository
            name: external-secrets
            namespace: flux-system
      values:
        installCRDs: true
      install:
        createNamespace: true
  YAML
}